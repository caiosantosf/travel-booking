{"version":3,"sources":["assets/logo.png","config/api.js","config/handleErrors.js","components/user/Login.js"],"names":["apiUrl","process","api","axios","create","baseURL","apiCep","cep","get","errorApi","error","hasOwnProperty","response","forbidden","status","data","message","general","toString","Login","props","useState","auth","setAuth","setError","loading","setLoading","setMessage","admin","match","url","exit","token","localStorage","getItem","returnTo","history","useHistory","useEffect","removeItem","push","setItem","type","getUserType","handleLogin","a","post","res","companyName","companyPhone","finishLogin","errorHandled","className","src","logo","alt","role","style","display","htmlFor","cpf","id","maxLength","value","onChange","e","key","target","test","password","to","onClick","disabled","aria-hidden"],"mappings":"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","file":"static/js/24.1fc6cd64.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.47d929e8.png\";","import axios from 'axios'\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL\r\n\r\nconst api = axios.create({\r\n  baseURL: apiUrl\r\n})\r\n\r\nconst apiCep = cep => (axios.get(`https://viacep.com.br/ws/${cep}/json/`))\r\n\r\nexport { api, apiCep, apiUrl }","const errorApi = (error) => {\r\n  if (error.hasOwnProperty('response') && error.response) {\r\n\r\n    let forbidden = false\r\n    if (error.response.hasOwnProperty('status') && error.response.status) {\r\n      forbidden = error.response.status === 401 ? true : false\r\n    } else {\r\n      forbidden = false\r\n    }\r\n\r\n    if (error.response.hasOwnProperty('data') && error.response.data) {\r\n      if (error.response.data.hasOwnProperty('message') && error.response.data.message) {\r\n        return { general: true, error: error.response.data.message, forbidden }\r\n      } else {\r\n        return { general: false, error: error.response.data, forbidden }\r\n      }\r\n    } else {\r\n      return { general: true, error: 'Algo errado aconteceu, tente novamente mais tarde', forbidden }\r\n    }\r\n  } else {\r\n    if (error.toString() === 'Error: Network Error') {\r\n      return { general: true, error:'Erro de rede, o banco de dados estÃ¡ fora do ar', forbidden: false }\r\n    } else {\r\n      return { general: true, error:'Algo errado aconteceu, tente novamente mais tarde', forbidden: false }\r\n    }\r\n  }\r\n}\r\n\r\nexport { errorApi }","import React, { useState, useEffect } from 'react'\r\nimport { Link, useHistory } from \"react-router-dom\"\r\nimport { api } from '../../config/api'\r\nimport logo from '../../assets/logo.png'\r\nimport { getUserType } from '../../config/security'\r\nimport { errorApi } from '../../config/handleErrors'\r\n\r\nfunction Login(props) {\r\n  const [auth, setAuth] = useState({})\r\n  const [error, setError] = useState({})\r\n  const [loading, setLoading] = useState(false)\r\n  const [message, setMessage] = useState('')\r\n\r\n  const admin = props.match.url === '/admin' ? true : false\r\n  const exit = props.match.url === '/sair' ? true : false\r\n  const token = localStorage.getItem('token')\r\n  const returnTo = localStorage.getItem('to')\r\n    \r\n  let history = useHistory()\r\n\r\n  useEffect(() => {\r\n    if (exit) {\r\n      localStorage.removeItem('token')  \r\n      history.push('/')\r\n    }\r\n  }, [exit, history])\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      if (returnTo) {\r\n        localStorage.setItem('to', '')\r\n        history.push(returnTo)\r\n      } else {\r\n        const type = getUserType()\r\n\r\n        if (type === 'admin') {\r\n          history.push('/admin-inicial')\r\n        } else {\r\n          if (type === 'regular') {\r\n            history.push('/')\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }, [token, history, returnTo])\r\n\r\n  const handleLogin = async () => {\r\n    try {\r\n      setLoading(true)\r\n      setError({})\r\n      const res = await api.post(`/users/login/${admin ? 'admin' : ''}`, auth)\r\n      const { token, companyName, companyPhone } = res.data\r\n      finishLogin(token, companyName, companyPhone)\r\n    } catch (error) {\r\n      const errorHandled = errorApi(error)\r\n      if (errorHandled.general) {\r\n        setMessage(errorHandled.error)\r\n      } else {\r\n        setError(errorHandled.error)\r\n      }\r\n\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const finishLogin = (token, companyName, companyPhone) => {\r\n    localStorage.setItem('token', token)\r\n    localStorage.setItem('companyName', companyName)\r\n    localStorage.setItem('companyPhone', companyPhone)\r\n    setLoading(false)\r\n  }\r\n\r\n  return (\r\n    <div className=\"container container-login\">\r\n      <form>\r\n        <div className=\"text-center mb-3\">\r\n          <img className=\"mb-3 img-login\" src={ logo } alt=\"Logo\" />\r\n          <h5>Sistema de reserva</h5>\r\n        </div>\r\n\r\n        <div className=\"mb-2\">\r\n\r\n          <div className='alert text-center alert-danger' role=\"alert\"\r\n               style={message ? { display: 'block'} : { display : 'none' }}>\r\n            {message}\r\n          </div>\r\n\r\n          <label htmlFor=\"cpf\" className=\"form-label\">CPF</label>\r\n\r\n          <input type=\"text\" \r\n                 className={`form-control ${error.cpf ? 'is-invalid' : ''}`}\r\n                 id=\"cpf\" \r\n                 maxLength=\"11\" \r\n                 value={auth.cpf || ''} \r\n                 onChange={e => {\r\n                  const re = /^[0-9\\b]+$/\r\n                  const key = e.target.value\r\n      \r\n                  if (key === '' || re.test(key)) {\r\n                    setAuth({ ...auth, cpf: key })\r\n                  }\r\n                 }}\r\n          />\r\n\r\n          <div id=\"validationCpf\" \r\n               className=\"invalid-feedback\" \r\n               style={error.cpf ? { display: 'inline' } : { display: 'none' }}>\r\n               {error.cpf}\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"mb-2\">\r\n          <label htmlFor=\"password\" className=\"form-label\">Senha</label>\r\n\r\n          <input type=\"password\" \r\n                 className={`form-control ${error.password ? 'is-invalid' : ''}`}\r\n                 id=\"password\" \r\n                 maxLength=\"8\" \r\n                 onChange={e => {\r\n                  setAuth({ ...auth,\r\n                    password: e.target.value\r\n                  })\r\n                 }}\r\n          />\r\n\r\n          <div id=\"validationPassword\" \r\n               className=\"invalid-feedback\" \r\n               style={error.password ? { display: 'inline' } : { display: 'none' }}>\r\n            {error.password}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mb-3\">\r\n          <Link to=\"/email-redefine-senha\">Esqueci minha senha</Link>\r\n        </div>\r\n\r\n        <div className=\"text-center d-grid gap-2\">\r\n          <button type=\"button\" \r\n                  className=\"btn btn-primary\"\r\n                  onClick={handleLogin}\r\n                  disabled={loading}>\r\n            <span className=\"spinner-border spinner-border-sm mx-1\" \r\n                  role=\"status\" \r\n                  aria-hidden=\"true\" \r\n                  style={loading ? { display: 'inline-block'} : { display : 'none' }}>\r\n            </span>\r\n            Entrar\r\n          </button>\r\n\r\n          <button type=\"button\" \r\n                  className=\"btn btn-warning text-white\" \r\n                  style={admin ? { display: 'none' } : { display: 'inline-block' }}\r\n                  onClick={() => {\r\n                    history.push('/registro')\r\n                  }}>\r\n            Cadastrar\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Login\r\n"],"sourceRoot":""}